<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <link rel="stylesheet" type="text/css" href="rof.css" />
  <script type="text/javascript">

/* constant things */
var outputEle, goEle, resetEle, chunks;
function onload() {
  outputEle = document.getElementById("output");
  goEle = document.getElementById("go");
  resetEle = document.getElementById("reset");
  chunks = loadData(document.getElementById("data").innerText);
  reset();
}

/* buttons */
var timer, songStart;
function go() {
  songStart = new Date().getTime();
  tick();
  resetEle.disabled = false;
  goEle.disabled = true;
}
function reset() {
  clearTimeout(timer);
  timer = "No Timer";
  outputEle.innerText = "";
  goEle.disabled = false;
  resetEle.disabled = true;
}

/* output */
function loadData(data) {
  var result = new Array();
  var r = /@[-0-9.]+@/gm;
  var startTime = 0;
  while (true) {
    var txtStart = r.lastIndex;
    var match = r.exec(data)
    if (!match) {
      break;
    }
    var endTime = parseFloat(match[0].slice(1,-1));
    result.push({start: startTime, end: endTime, text: data.slice(txtStart, match.index)});
    startTime = endTime;
  }
  return result;
}
function textPosAtTime(chunk, time) {
  return Math.max(0, Math.min(chunk.text.length,
    chunk.text.length * (time - chunk.start) / (chunk.end - chunk.start)));
}
function tick() {
  var songTime = new Date().getTime() - songStart;
  var newText = "";
  for (var i = 0; i < chunks.length; i++) {
    var chunk = chunks[i];
    newText = newText + chunk.text.substring(0, textPosAtTime(chunk, songTime/1000));
  }
  outputEle.innerText = newText + "_";
  timer = setTimeout("tick()", 10);
}

  </script>
  <title>Textplay</title>
</head>
<body onload="onload();">
  <pre id="data" style="display:none">
As the Chief's weapon approaches her, Kaylyn stands firm.  Whatever happens at this point, she will not back down.  Not when there are people who depend on her.  Her thoughts wander to the prone figure behind her, helpless without her protection.  They wander further to Liz, being taken to God only knows where. Helpless.  She knows she shouldn't think like that, but there's really no-one else.  The only one who can do anything is her.  The only one who can save everybody is her.@21@

So she won't back down, she thinks as she watches the weapon descend in slow motion. She'll protect everyone. She doesn't know how, but she will.@30@


@31@So Be It.@31.5@
  </pre>
  <h1>Textplay</h1>
  <p>
Created to assist <a href="http://mspaforums.com/member.php?1072019-mysticCharlatan">mysticCharlatan</a>
in their creation of <a href="http://mspaforums.com/showthread.php?45037-Recursion-of-Fate-TEXT"><i>Recursion of Fate</i></a>,
specifically the text [S] updates.
First, open <a href="http://homestuck.bandcamp.com/track/gaia-queen" target="_blank"><cite>Gaia Queen</cite></a> and play it.  The moment it starts, click "Go" here.
  </p>
  <input id="go" type="button" onclick="go();" value="Go" />
  <input id="reset" type="button" onclick="reset();" value="Reset" />
  <div class="output" id="output"></div>
  <p>Written by <a href="http://mspaforums.com/member.php?60695-simon-clarkstone">Simon Richard Clarkstone</a>.
  <br>
  <br>
  </p>
</body>
</html>